<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>æ°´ç­èƒ½é‡ç«™</title>
    <script src="config.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --primary-pink: #ff85a2; --bg: #fff9fa; }
        body { font-family: 'PingFang SC', sans-serif; background: var(--bg); display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .container { width: 310px; background: white; border-radius: 35px; padding: 30px; box-shadow: 0 15px 40px rgba(255,133,162,0.1); text-align: center; position: relative; }
        .logo { font-size: 70px; margin-bottom: 20px; }
        h2 { color: var(--primary-pink); font-size: 20px; margin: 0 0 15px; }
        input { width: 100%; border: none; background: #fef0f3; padding: 18px; border-radius: 20px; font-size: 20px; text-align: center; box-sizing: border-box; outline: none; color: var(--primary-pink); letter-spacing: 3px; font-weight: bold; }
        .btn-go { width: 100%; background: var(--primary-pink); color: white; border: none; padding: 18px; border-radius: 50px; font-size: 16px; cursor: pointer; font-weight: bold; margin-top: 25px; box-shadow: 0 6px #ffdae3; }
        
        /* æ¢å¤å¤‡ä»½åŒºåŸŸæ ·å¼ */
        .recovery-link { margin-top: 25px; font-size: 13px; color: #bbb; cursor: pointer; text-decoration: underline; transition: color 0.3s; }
        .recovery-link:hover { color: var(--primary-pink); }
        
        #guide-box { display: none; }
        .instruction { text-align: left; background: #fff9fa; padding: 20px; border-radius: 20px; margin: 20px 0; font-size: 13px; color: #777; line-height: 1.8; }
        .highlight { color: var(--primary-pink); font-weight: bold; }
        .lang-toggle { position: absolute; top: 15px; right: 20px; font-size: 12px; color: var(--primary-pink); font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<div class="container">
    <div class="lang-toggle" onclick="toggleLang()" id="lang-btn">EN</div>

    <div id="auth-ui">
        <div class="logo">ğŸ¦¦</div>
        <h2 id="t-auth-title">æ¿€æ´»æ‚¨çš„èƒ½é‡ç«™</h2>
        <input type="text" id="activation-code" placeholder="ENTER CODE">
        <button class="btn-go" onclick="handleVerify()" id="t-auth-btn">ç«‹å³éªŒè¯</button>
        
        <div class="recovery-link" onclick="document.getElementById('restore-file').click()" id="t-recover">
            é€šè¿‡å¤‡ä»½æ–‡ä»¶å¤åŸæ•°æ®
        </div>
        <input type="file" id="restore-file" accept=".json" onchange="importStellarockData(event)" style="display:none;">
    </div>

    <div id="guide-box">
        <div class="logo">ğŸ“±</div>
        <h2 id="t-guide-title">ä½¿ç”¨è¯´æ˜</h2>
        <div class="instruction" id="t-instruction">
            1ï¸âƒ£ ç‚¹å‡»æµè§ˆå™¨åº•éƒ¨çš„ <span class="highlight">åˆ†äº«æŒ‰é’®</span> (æ–¹å—ç®­å¤´)<br>
            2ï¸âƒ£ å‘ä¸Šæ»‘åŠ¨æ‰¾åˆ° <span class="highlight">â€œæ·»åŠ åˆ°ä¸»å±å¹•â€</span><br>
            3ï¸âƒ£ ç‚¹å‡»å³ä¸Šè§’ <span class="highlight">â€œæ·»åŠ â€</span><br><br>
            å®Œæˆåä»æ¡Œé¢å›¾æ ‡è¿›å…¥ã€‚
        </div>
        <button class="btn-go" onclick="enterApp()" id="t-guide-btn">è¿›å…¥ç³»ç»Ÿ</button>
    </div>
</div>

<script>

    if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js')
            .then(reg => console.log('é—¨ç¦ç®¡å®¶å·²å°±ä½', reg.scope))
            .catch(err => console.log('ç®¡å®¶ç½¢å·¥äº†', err));
    });
}

    
    const CODES = ["PSGJFMQX","NVXGUFXX","T3QR5HXL","GHHUAYQQ","4U5TDPMC","QMU7F2E2","2SR4HEU9","8DUWM4UW","2CCF7RDK","4QS4B7YX","77W44PWF","L5D82VZQ","YPU6PLT3","B4ENWZDX","S5NSAJ4G","CCQG7B6R","BBT8FTJH","546RMDX5","Z7C9SDJZ","K9YLBHYS","2F3X2QQQ","7SUZKH4N","E9NEYJJC","343U9DNA","D7W82QQF","2QLF26D4","JXSCTLG3","L69SJAH3","TZZ5ZFVT","USMD7744","ZJWWTQDR","YBR3USQ9","K7TRTGL4","WXNG6HSB","894TSGX8","RQ6XLKUG","AG7Z88SE","2YJYHWTW","FKWK38L5","5XT54EP4","HLDNJSPL","DS49PWEH","E7UFKNCF","F6D65UUJ","HRCUE477","J2CRTFZ4","XV4B7PX4","ND8ELKAT","BJ75JAFR","DB8HATFA","CVXRR8VS","NSDUUGL5","XBHQFSCB","26WWR9VU","ABNSMU5A","CFXLZWYJ","65J85WQP","QRKH2MVP","TFH86Z9V","RYWV4W93","EE438L6G","WU8T2NPF","MYPPAZ77","6GX5447N","ZX74KSG5","WGES64DB","NR6H8XX6","QB3N9YTZ","TF6WJZ67","XWV4KZHX","XSYCDLHB","QMABA2GY","J32TYB5D","QFGLC6MJ","G6C797BN","2W394327","FM2G6ART","44ET8X2M","H27M5UH4","TCFSZ7GP","8SNV5SMH","MD7AYYNV","75XG2E3R","NKAEYBXQ","6ZAGFG35","EZM5RNGY","5PDX9587","UM359UGD","2Y5DC65R","YX8BCKJ2","RTVLDGSJ","8ZWME5DY","9J2XAMLL","2ZQQ33UX","WKJJL2ZJ","XY9EP4DN","FNQXNADX","C37PNA5D","RQVZNYS3"]; 
    const BLACKLIST = ["KDRBLCC9"]; 
    let currentLang = localStorage.getItem('lang') || 'zh';

    const translations = {
        'zh': {
            'btn': 'EN',
            'authTitle': 'æ¿€æ´»æ‚¨çš„èƒ½é‡ç«™',
            'authBtn': 'ç«‹å³éªŒè¯',
            'recover': 'é€šè¿‡å¤‡ä»½æ–‡ä»¶å¤åŸæ•°æ®',
            'guideTitle': 'ä½¿ç”¨è¯´æ˜',
            'guideBtn': 'è¿›å…¥ç³»ç»Ÿ',
            'instruction': 'ä¸ºäº†è·å¾— <span class="highlight">APP</span> ä½“éªŒï¼š<br><br>1ï¸âƒ£ ç‚¹å‡»æµè§ˆå™¨åº•éƒ¨çš„ <span class="highlight">åˆ†äº«æŒ‰é’®</span><br>2ï¸âƒ£ å‘ä¸Šæ»‘åŠ¨æ‰¾åˆ° <span class="highlight">â€œæ·»åŠ åˆ°ä¸»å±å¹•â€</span><br>3ï¸âƒ£ ç‚¹å‡»å³ä¸Šè§’ <span class="highlight">â€œæ·»åŠ â€</span><br><br>å®Œæˆåä»æ¡Œé¢å›¾æ ‡è¿›å…¥ã€‚',
            'error': 'æ¿€æ´»ç é”™è¯¯ï¼Œè¯·è”ç³»ä¸»ç†äºº ğŸ¦¦',
            'importSuccess': 'âœ… èµ„äº§è¿˜åŸæˆåŠŸï¼Œæ¬¢è¿å›æ¥ï¼',
            'importError': 'âŒ æ— æ•ˆçš„å¤‡ä»½æ–‡ä»¶ã€‚'
        },
        'en': {
            'btn': 'ä¸­æ–‡',
            'authTitle': 'Activate Station',
            'authBtn': 'Verify Now',
            'recover': 'Restore from Backup File',
            'guideTitle': 'Instructions',
            'guideBtn': 'Enter System',
            'instruction': 'To <span class="highlight">App Experience</span>:<br><br>1ï¸âƒ£ Click the <span class="highlight">Share Icon</span><br>2ï¸âƒ£ Tap <span class="highlight">"Add to Home Screen"</span><br>3ï¸âƒ£ Tap <span class="highlight">"Add"</span> on the top right.<br><br>Then open from home screen.',
            'error': 'Invalid Code. ğŸ¦¦',
            'importSuccess': 'âœ… Assets Restored! Welcome back.',
            'importError': 'âŒ Invalid Backup File.'
        }
    };

    function updateUI() {
        const t = translations[currentLang];
        document.getElementById('lang-btn').innerText = t.btn;
        document.getElementById('t-auth-title').innerText = t.authTitle;
        document.getElementById('t-auth-btn').innerText = t.authBtn;
        document.getElementById('t-recover').innerText = t.recover;
        document.getElementById('t-guide-title').innerText = t.guideTitle;
        document.getElementById('t-guide-btn').innerText = t.guideBtn;
        document.getElementById('t-instruction').innerHTML = t.instruction;
    }

    function toggleLang() {
        currentLang = currentLang === 'zh' ? 'en' : 'zh';
        localStorage.setItem('lang', currentLang);
        updateUI();
    }

    function handleVerify() {
        const input = document.getElementById('activation-code').value.trim().toUpperCase();
        if (BLACKLIST.includes(input)) {
            alert(currentLang === 'zh' ? "è¯¥æ¿€æ´»ç å·²ä½œåºŸ ğŸ¦¦" : "Code disabled. ğŸ¦¦");
            return;
        }
        if (CODES.includes(input)) {
            localStorage.setItem('isActivated', 'true');
            showGuide();
        } else {
            alert(translations[currentLang].error);
        }
    }

    // --- æ•°æ®èµ„äº§è¿˜åŸæ ¸å¿ƒå¼•æ“ ---
    function importStellarockData(event) {
        const file = event.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const data = JSON.parse(e.target.result);
                // éªŒè¯æ˜¯å¦ä¸ºæœ‰æ•ˆçš„ Stellarock å¤‡ä»½ï¼ˆå¿…é¡»åŒ…å«æ¿€æ´»æ ‡è®°æˆ–å†å²æ•°æ®ï¼‰
                if (data.isActivated === 'true' || data.revenue_history) {
                    localStorage.clear();
                    for (let key in data) {
                        localStorage.setItem(key, data[key]);
                    }
                    // å¼ºåˆ¶ç¡®ä¿æ¿€æ´»çŠ¶æ€
                    localStorage.setItem('isActivated', 'true');
                    alert(translations[currentLang].importSuccess);
                    enterApp(); // ç›´æ¥è¿›å…¥ï¼Œæ— éœ€çœ‹å¼•å¯¼
                } else {
                    throw new Error();
                }
            } catch (err) {
                alert(translations[currentLang].importError);
            }
        };
        reader.readAsText(file);
    }

    function showGuide() {
        document.getElementById('auth-ui').style.display = 'none';
        document.getElementById('guide-box').style.display = 'block';
    }

    function enterApp() {
        window.location.replace('index.html');
    }

    if (localStorage.getItem('isActivated') === 'true') {
        // å¦‚æœå·²æ¿€æ´»ï¼Œç›´æ¥è¿›å¼•å¯¼é¡µï¼ˆæˆ–ç›´æ¥è¿›Appï¼Œæ ¹æ®ä½ çš„PMé€»è¾‘å†³å®šï¼‰
        showGuide();
    }
    updateUI();
</script>
</body>
</html>
