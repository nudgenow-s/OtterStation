<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SugarBroccoli - ç»è¥å¤šé‚»å›½</title>
    <style>
        :root {
            --duo-green: #58cc02; --duo-border: #46a302;
            --duo-orange: #ff9600; --duo-blue: #1cb0f6;
            --duo-red: #ff4b4b; --bg: #ffffff;
        }
        body { font-family: "din-round", "PingFang SC", sans-serif; background: var(--bg); display: flex; justify-content: center; padding: 20px; margin: 0; }
        
        .app-container { width: 100%; max-width: 420px; }

        /* é¡¶éƒ¨çŠ¶æ€æ ï¼šå¤šé‚»å›½æ ‡å¿—æ€§çš„è¿›åº¦æ¡ */
        .top-nav { display: flex; align-items: center; gap: 15px; margin-bottom: 30px; }
        .progress-container { flex-grow: 1; height: 16px; background: #e5e5e5; border-radius: 20px; position: relative; }
        .progress-bar { height: 100%; width: 0%; background: var(--duo-green); border-radius: 20px; transition: 0.5s; box-shadow: inset 0 -4px rgba(0,0,0,0.1); }

        /* æ ¸å¿ƒå¡ç‰‡æ ·å¼ */
        .card {
            background: white; border: 2px solid #e5e5e5; border-bottom: 6px solid #e5e5e5;
            border-radius: 20px; padding: 20px; margin-bottom: 20px; position: relative;
        }
        .card:active { border-bottom-width: 2px; transform: translateY(4px); }

        /* å¤šé‚»å›½å¼è§’è‰²æç¤º */
        .duo-character { display: flex; gap: 15px; align-items: center; margin-bottom: 20px; }
        .owl { font-size: 50px; }
        .speech-bubble {
            background: white; border: 2px solid #e5e5e5; padding: 10px 15px;
            border-radius: 15px; position: relative; font-weight: bold; font-size: 14px;
        }

        /* æŒ‰é’®ï¼šæ ‡å¿—æ€§çš„åšå®æ„Ÿ */
        .btn {
            width: 100%; padding: 15px; border-radius: 15px; border: none;
            font-weight: bold; font-size: 16px; cursor: pointer; transition: 0.1s;
            text-transform: uppercase; letter-spacing: 1px;
        }
        .btn-green { background: var(--duo-green); color: white; border-bottom: 5px solid var(--duo-border); }
        .btn-blue { background: var(--duo-blue); color: white; border-bottom: 5px solid #148fcc; }
        .btn:active { border-bottom-width: 0; transform: translateY(5px); }

        /* è¾“å…¥æ¡† */
        textarea, input {
            width: 100%; border: 2px solid #e5e5e5; border-radius: 15px;
            padding: 12px; box-sizing: border-box; font-size: 16px; outline: none; background: #f7f7f7;
        }

        /* éšè— section çš„é€»è¾‘ */
        .hidden { display: none; }
    </style>
</head>
<body>

  <div class="card" style="text-align:center; padding: 15px;">
    <p style="margin:0 0 10px 0; font-size:12px; color:#afafaf; font-weight:bold;">æˆå°±å‹‹ç« </p>
    <div id="badge-wall" style="display:flex; justify-content:center; gap:10px; font-size:24px; filter: grayscale(100%); opacity: 0.3;">
        <span title="é¦–å•å…¥è´¦">ğŸ’°</span>
        <span title="ç›ˆåˆ©ç‹è€…">ğŸ‘‘</span>
        <span title="ç²¾æ˜çŒæ‰‹">ğŸ¦Š</span>
        <span title="æ‹’ç»æ‹–å»¶">ğŸ”¥</span>
    </div>
  </div>

    
<div class="app-container">
    <div class="top-nav">
        <span style="font-size: 24px;">ğŸ¦‰</span>
        <div class="progress-container">
            <div id="main-progress" class="progress-bar"></div>
        </div>
        <span id="score-val" style="font-weight: bold; color: var(--duo-green);">0%</span>
    </div>

    <div class="duo-character">
        <div class="owl" id="owl-face">ğŸ¤”</div>
        <div class="speech-bubble" id="owl-msg">è¿˜æ²¡è®°è´¦ï¼Ÿæˆ¿ä¸œå¯ä¸ä¼šç­‰ä½ ï¼</div>
    </div>

    <div class="card" id="config-card">
        <div style="display: flex; gap: 10px;">
            <button class="btn btn-blue" style="flex:1" onclick="switchIndustry('nail')">ğŸ’… ç¾ç”²</button>
            <button class="btn btn-blue" style="flex:1" onclick="switchIndustry('food')">ğŸŒ­ æ‘†æ‘Š</button>
        </div>
    </div>

    <div class="card">
        <p style="margin-top:0; font-weight: bold; color: #afafaf;">å–‚å…¥é‡‡è´­æˆªå›¾æ–‡æœ¬</p>
        <textarea id="ocr-data" rows="2">å®ä»˜: Â¥500 æ•°é‡: 100å¼ </textarea>
        <button class="btn btn-green" style="margin-top:15px;" onclick="handleVision()">åŒæ­¥æˆæœ¬æ•°æ®</button>
    </div>

    <div class="card">
        <p style="margin-top:0; font-weight: bold; color: #afafaf;">å½•å…¥ä»Šæ—¥æ”¶å…¥</p>
        <input type="number" id="revenue-val" placeholder="Â¥ 0.00">
        <button class="btn btn-green" style="margin-top:15px;" onclick="handleSale()">å®Œæˆä¸€ç¬”æˆäº¤ï¼</button>
    </div>

    <div id="alert-zone"></div>
</div>

<script src="config.js"></script>
<script src="vision.js"></script>
<script src="accounting.js"></script>
<script src="alert.js"></script>

<script>

    
    // é€»è¾‘æ›´æ–°ï¼šæ¯æ¬¡æ“ä½œåè¿è¡Œæˆå°±æ£€æŸ¥
    function updateBadgeWall() {
        const earned = JSON.parse(localStorage.getItem('earned_badges')) || [];
        const spans = document.querySelectorAll('#badge-wall span');
        const badgeIds = ['first_blood', 'profitable_king', 'smart_buyer', 'anti_procrastination'];
        
        spans.forEach((span, index) => {
            if (earned.includes(badgeIds[index])) {
                span.style.filter = 'none';
                span.style.opacity = '1';
            }
        });
    }

    // åœ¨ handleSale ç»“å°¾å¤„è°ƒç”¨
    // AchievementSystem.check({ totalSales: 10, streak: 3, ... });
    // updateBadgeWall();


    // UI äº¤äº’èƒ¶æ°´ä»£ç 
    function switchIndustry(type) {
        IndustryAdapter.setIndustry(type);
        updateOwl("ğŸ¥³", `å·²åˆ‡æ¢åˆ°${IndustryAdapter.getCurrent().name}æ¨¡å¼ï¼`);
    }

    async function handleVision() {
        const text = document.getElementById('ocr-data').value;
        const res = await UniversalVision.parseAnyReceipt(text);
        AccountingEngine.syncPurchase(res.itemName, res.unitCost, res.quantity);
        updateOwl("ğŸ¤©", `å“‡ï¼è¯†åˆ«åˆ°äº†${res.quantity}ä»¶${res.itemName}ï¼Œæ¯ä»¶æ‰Â¥${res.unitCost}ï¼Ÿå¤ªä¼šä¹°äº†ï¼`);
    }

    function handleSale() {
        const rev = parseFloat(document.getElementById('revenue-val').value) || 0;
        const lib = JSON.parse(localStorage.getItem('cost_lib')) || {};
        const firstItem = Object.keys(lib)[0] || "é€šç”¨è€—æ";
        
        const res = AccountingEngine.calculateProfit(rev, firstItem);
        
        // æ›´æ–°è¿›åº¦æ¡ (ä»¥æ—¥ç›®æ ‡ä¸ºåŸºå‡†)
        const dailyTarget = parseFloat(localStorage.getItem('dailyTarget')) || 333;
        const progress = Math.min((rev / dailyTarget) * 100, 100);
        document.getElementById('main-progress').style.width = progress + '%';
        document.getElementById('score-val').innerText = Math.floor(progress) + '%';

        // çŠ¶æ€æ›´æ–°
        if (progress < 100) {
            updateOwl("ğŸ˜’", `åªæœ‰ ${Math.floor(progress)}%ï¼Ÿä»Šå¤©çš„æˆ¿ç§Ÿè¿˜æ²¡èµšå‡ºæ¥å“¦ï¼`);
        } else {
            updateOwl("ğŸ‘‘", `100%ï¼å‰©ä¸‹çš„å…¨æ˜¯åˆ©æ¶¦ï¼Œå»ä¹°æ¯å¥¶èŒ¶å§ï¼`);
        }

        // æ£€æŸ¥åº“å­˜é¢„è­¦
        const alertHtml = AlertSystem.check(firstItem, res.remainingStock, lib[firstItem]?.total || 100);
        document.getElementById('alert-area')?.remove(); // æ¸…ç†æ—§é¢„è­¦
        if(alertHtml) {
            const div = document.createElement('div');
            div.id = 'alert-area';
            div.innerHTML = alertHtml;
            document.body.appendChild(div);
            updateOwl("ğŸ˜±", "å¤§äº‹ä¸å¥½ï¼è€—æå¿«ç”¨å…‰äº†ï¼Œå¿«å»è¿›è´§ï¼");
        }
    }

    function updateOwl(face, msg) {
        document.getElementById('owl-face').innerText = face;
        document.getElementById('owl-msg').innerText = msg;
    }
</script>

</body>
</html>
