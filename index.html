<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>SugarBroccoli Engine V2.0</title>
    <style>
        body { font-family: sans-serif; padding: 30px; background: #fff9fa; }
        .box { max-width: 500px; margin: 0 auto; background: #fff; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        .section { margin-bottom: 25px; border-bottom: 1px solid #eee; padding-bottom: 15px; }
        .btn { background: #ff85a2; color: white; border: none; padding: 10px 20px; border-radius: 50px; cursor: pointer; }
    </style>
</head>
<body>
<div class="box">
    <div class="section">
        <h3>1. è¡Œä¸šé€‰æ‹©</h3>
        <button onclick="IndustryAdapter.setIndustry('nail');location.reload()">ğŸ’… ç¾ç”²</button>
        <button onclick="IndustryAdapter.setIndustry('food');location.reload()">ğŸŒ­ å°åƒ</button>
    </div>
    <div class="section">
        <h3>2. é‡‡è´­æå– (Vision)</h3>
        <textarea id="ocr" style="width:100%">æ‹¼å¤šå¤šè®¢å•ï¼šå”®åå¡ x100 å®ä»˜:Â¥500</textarea>
        <button class="btn" onclick="doVision()">è§£ææˆªå›¾</button>
    </div>
    <div class="section">
        <h3>3. æ¨¡æ‹Ÿé”€å”® (Accounting)</h3>
        <button class="btn" onclick="doSale()">è®°å½•ä¸€å•æ”¶å…¥ (Â¥198)</button>
        <div id="log" style="margin-top:10px; font-size:13px; color:#666;"></div>
        <div id="alert-area"></div>
    </div>
</div>

<script src="config.js"></script>
<script src="vision.js"></script>
<script src="accounting.js"></script>
<script src="alert.js"></script>
<script>
    async function doVision() {
        const res = await UniversalVision.parseAnyReceipt(document.getElementById('ocr').value);
        AccountingEngine.syncPurchase(res.itemName, res.unitCost, res.quantity);
        alert(`åŒæ­¥æˆåŠŸï¼${res.itemName} å•ä»¶æˆæœ¬: Â¥${res.unitCost}`);
    }

    function doSale() {
        const lib = JSON.parse(localStorage.getItem('cost_lib'));
        const firstItem = Object.keys(lib)[0]; 
        const res = AccountingEngine.calculateProfit(198, firstItem);
        
        document.getElementById('log').innerHTML = `
            ä»Šæ—¥æœåŠ¡å‡€åˆ©: Â¥${res.netProfit} (æ‰£é™¤è€—æ: Â¥${res.unitCost})<br>
            ${firstItem} å‰©ä½™åº“å­˜: ${res.remainingStock}`;
        
        const alertHtml = AlertSystem.check(firstItem, res.remainingStock, lib[firstItem].total);
        document.getElementById('alert-area').innerHTML = alertHtml;
    }
</script>
</body>
</html>
